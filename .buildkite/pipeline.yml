env:
  CUDA_VISIBLE_DEVICES: 3

steps:
  - label: ":rabbit2: unit tests"
    env:
      TEST_GROUP: "unit"
    commands:
      - "wget -nv https://raw.githubusercontent.com/JuliaCI/install-julia/master/install-julia.sh"
      - "eval $$(bash install-julia.sh 1.4)"
      - "julia --color=yes --project -e 'using Pkg; Pkg.instantiate()'"
      - "julia --color=yes --project -e 'using Pkg; Pkg.test()'"
    agents:
      queue: tartarus


  - label: ":dolphin: model tests"
    env:
      TEST_GROUP: "model"
    commands:
      - "wget -nv https://raw.githubusercontent.com/JuliaCI/install-julia/master/install-julia.sh"
      - "eval $$(bash install-julia.sh 1.4)"
      - "julia --color=yes --project -e 'using Pkg; Pkg.instantiate()'"
      - "julia --color=yes --project -e 'using Pkg; Pkg.test()'"
    agents:
      queue: tartarus

  - label: ":whale: simulation tests"
    env:
      TEST_GROUP: "simulation"
    commands:
      - "wget -nv https://raw.githubusercontent.com/JuliaCI/install-julia/master/install-julia.sh"
      - "eval $$(bash install-julia.sh 1.4)"
      - "julia --color=yes --project -e 'using Pkg; Pkg.instantiate()'"
      - "julia --color=yes --project -e 'using Pkg; Pkg.test()'"
    agents:
      queue: tartarus
 
  - label: ":camel: regression tests"
    env:
      TEST_GROUP: "regression"
    commands:
      - "wget -nv https://raw.githubusercontent.com/JuliaCI/install-julia/master/install-julia.sh"
      - "eval $$(bash install-julia.sh 1.4)"
      - "julia --color=yes --project -e 'using Pkg; Pkg.instantiate()'"
      - "julia --color=yes --project -e 'using Pkg; Pkg.test()'"
    agents:
      queue: tartarus

  - label: ":gorilla: scripts"
    env:
      TEST_GROUP: "scripts"
    commands:
      - "wget -nv https://raw.githubusercontent.com/JuliaCI/install-julia/master/install-julia.sh"
      - "eval $$(bash install-julia.sh 1.4)"
      - "julia --color=yes --project -e 'using Pkg; Pkg.instantiate()'"
      - "julia --color=yes --project -e 'using Pkg; Pkg.test()'"
    agents:
      queue: tartarus

  # - label: ":sauropod: convergence tests"
  #   env:
  #     TEST_GROUP: "convergence"
  #   commands:
  #     - "wget -nv https://raw.githubusercontent.com/JuliaCI/install-julia/master/install-julia.sh"
  #     - "eval $$(bash install-julia.sh 1.4)"
  #     - "julia --color=yes --project -e 'using Pkg; Pkg.instantiate()'"
  #     - "julia --color=yes --project -e 'using Pkg; Pkg.test()'"
  #   agents:
  #     queue: tartarus

  - label: ":owl: documentation"
    commands:
      - "wget -nv https://raw.githubusercontent.com/JuliaCI/install-julia/master/install-julia.sh"
      - "eval $$(bash install-julia.sh 1.4)"
      - "julia --color=yes --project=docs/ -e 'using Pkg; Pkg.instantiate(); Pkg.develop(PackageSpec(path=pwd()))'"
      - "julia --color=yes --project=docs/ docs/make.jl"
    agents:
      queue: tartarus
